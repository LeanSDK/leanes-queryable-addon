"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=e((function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(r,n)}t.exports=e}));var n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)},o=e((function(t){function e(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(r)}t.exports=e}));var i=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var u=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?i(t):e},a=e((function(t){function e(r){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(r)}t.exports=e}));var c=function(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(t,e,i),i=null),i};var s=function(t,e,r,n){r&&Object.defineProperty(t,e,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})},p=e((function(t){var e=function(t){var e,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),u=new R(n||[]);return i._invoke=function(t,e,r){var n=l;return function(o,i){if(n===f)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw i;return N()}for(r.method=o,r.arg=i;;){var u=r.delegate;if(u){var a=j(u,r);if(a){if(a===v)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var c=p(t,e,r);if("normal"===c.type){if(n=r.done?h:y,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=h,r.method="throw",r.arg=c.arg)}}}(t,r,u),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var l="suspendedStart",y="suspendedYield",f="executing",h="completed",v={};function b(){}function m(){}function d(){}var w={};w[i]=function(){return this};var g=Object.getPrototypeOf,O=g&&g(g(q([])));O&&O!==r&&n.call(O,i)&&(w=O);var x=d.prototype=b.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function $(t,e){function r(o,i,u,a){var c=p(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,u,a)}),(function(t){r("throw",t,u,a)})):e.resolve(l).then((function(t){s.value=t,u(s)}),(function(t){return r("throw",t,u,a)}))}a(c.arg)}var o;this._invoke=function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}}function j(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=p(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function q(t){if(t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,u=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return u.next=u}}return{next:N}}function N(){return{value:e,done:!0}}return m.prototype=x.constructor=d,d.constructor=m,m.displayName=c(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,a,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},k($.prototype),$.prototype[u]=function(){return this},t.AsyncIterator=$,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var u=new $(s(e,r,n,o),i);return t.isGeneratorFunction(r)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},k(x),c(x,a,"Generator"),x[i]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=q,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return a.type="throw",a.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var c=n.call(u,"catchLoc"),s=n.call(u,"finallyLoc");if(c&&s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=t,u.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(u)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),D(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;D(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:q(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));function l(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(n,o)}var y=function(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function u(t){l(i,n,o,u,a,"next",t)}function a(t){l(i,n,o,u,a,"throw",t)}u(void 0)}))}};function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(t,e,r){return e&&f(t.prototype,e),r&&f(t,r),t};var v=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t},b=e((function(t){function e(r,n,o){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=e=Reflect.get:t.exports=e=function(t,e,r){var n=v(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},e(r,n,o||r)}t.exports=e}));function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}var d={}.hasOwnProperty;function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}module.exports=function(e){var r=e.NS,o=r.initializeMixin,u=r.meta;return["QueryableAddon",function(e){var r,l,f,v,$;return function(e){var r=e.NS,o=r.initializeMixin,u=r.meta,a=r.method,l=r.chains,f=r.property,v=r.Utils,b=v._,m=v.joi;v.assert,e.defineMixin("/mixins/QueryableResourceMixin.js",(function(r){var v,d,w,g,O,k,$,j,P,D;return v=l(["query","list"],(function(){this.initialHook("parseBody",{only:["query"]}),this.beforeHook("getQuery",{only:["list"]})})),d=r.Module.NS.action,w=r.Module.NS.action,o(g=v((D=P=function(r){n(l,r);var o,u,a,c=x(l);function l(){var e;t(this,l);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=c.call.apply(c,[this].concat(n)),s(e,"needsLimitation",$,i(e)),s(e,"listQuery",j,i(e)),e}return h(l,[{key:"getQuery",value:function(){this.listQuery=JSON.parse(this.context.query.query||"{}");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e}},{key:"showNoHiddenByDefault",value:(a=y(p.mark((function t(){var e,r,n,o=arguments;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(null!=this.listQuery.$filter?/.*\@doc\.isHidden.*/.test(JSON.stringify(this.listQuery.$filter))||(this.listQuery.$filter={$and:[this.listQuery.$filter,{"@doc.isHidden":!1}]}):this.listQuery.$filter={"@doc.isHidden":!1},e=o.length,r=new Array(e),n=0;n<e;n++)r[n]=o[n];return t.abrupt("return",r);case 3:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"list",value:(u=y(p.mark((function t(){var r,n,o,i,u,a=this;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=b.pick(this.listQuery,["$filter","$sort","$limit","$offset"]),n=e.NS.Query.new().forIn({"@doc":this.collection.collectionFullName()}).return("@doc"),r.$filter&&(c=void 0,null!=(c=m.object().validate(r.$filter).error)&&a.context.throw(400,"ValidationError: `$filter` must be an object",c.stack),n.filter(r.$filter)),r.$sort&&(null!=m.array().items(m.object()).validate(r.$sort).error&&a.context.throw(400,"ValidationError: `$sort` must be an array"),r.$sort.forEach((function(t){return n.sort(t)}))),r.$limit&&(function(){var t=m.number().validate(r.$limit).error;null!=t&&a.context.throw(400,"ValidationError: `$limit` must be a number",t.stack)}(),n.limit(r.$limit)),r.$offset&&(function(){var t=m.number().validate(r.$offset).error;null!=t&&a.context.throw(400,"ValidationError: `$offset` must be a number",t.stack)}(),n.offset(r.$offset)),o=null!=n.$limit?Number(n.$limit):50,this.needsLimitation?n.limit(function(){switch(!1){case!(o>50):case!(o<0):case!isNaN(o):return 50;default:return o}}()):isNaN(o)||n.limit(o),i=null!=n.$offset?Number(n.$offset):0,n.offset(function(){switch(!1){case!(i<0):case!isNaN(i):return 0;default:return i}}()),t.next=12,this.collection.query(n);case 12:return t.next=14,t.sent.toArray();case 14:return u=t.sent,t.abrupt("return",{meta:{pagination:{limit:null!=n.$limit?n.$limit:"not defined",offset:null!=n.$offset?n.$offset:"not defined"}},items:u});case 16:case"end":return t.stop()}var c}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"query",value:(o=y(p.mark((function t(){var e;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.context.request.body,t.next=3,this.collection.query(e.query);case 3:return t.next=5,t.sent.toArray();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})}]),l}(r),P.object={},c(O=D,"object",[u],(k=(k=Object.getOwnPropertyDescriptor(O,"object"))?k.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return k}}),O),$=c(O.prototype,"needsLimitation",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),j=c(O.prototype,"listQuery",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),c(O.prototype,"getQuery",[a],Object.getOwnPropertyDescriptor(O.prototype,"getQuery"),O.prototype),c(O.prototype,"showNoHiddenByDefault",[a],Object.getOwnPropertyDescriptor(O.prototype,"showNoHiddenByDefault"),O.prototype),c(O.prototype,"list",[d],Object.getOwnPropertyDescriptor(O.prototype,"list"),O.prototype),c(O.prototype,"query",[w],Object.getOwnPropertyDescriptor(O.prototype,"query"),O.prototype),g=O))||g)||g}))}(r=function(e){var r=e.NS,o=r.assert,u=r.initializeMixin,l=r.meta,f=r.property,v=r.method,m=r.Utils,d=m._;m.inflect,m.request,e.defineMixin("/mixins/QueryableHttpAdapterMixin.js",(function(e){var r,m,w,g,x,k;return u((k=x=function(e){n(x,e);var r,u,c,l,f,v,m,w=O(x);function x(){var e;t(this,x);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return e=w.call.apply(w,[this].concat(n)),s(e,"queryEndpoint",g,i(e)),e}return h(x,[{key:"takeBy",value:(m=y(p.mark((function t(e,r){var n,i,u,a,c,s=arguments;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:{},(i={}).requestType="takeBy",i.recordName=e.name,i.query={$filter:r},null!=n.$sort&&(i.query.$sort=n.$sort),null!=n.$limit&&(i.query.$limit=n.$limit),null!=n.$offset&&(i.query.$offset=n.$offset),u=this.requestFor(i),t.next=11,this.makeRequest(u);case 11:if(a=t.sent,o(a.status<400,"Request failed with status ".concat(a.status," ").concat(a.message)),null==(c=a.body)||""===c){t.next=19;break}return d.isString(c)&&(c=JSON.parse(c)),t.abrupt("return",c[this.recordMultipleName(e.name)]);case 19:o.fail("Record payload has not existed in response body.");case 20:case"end":return t.stop()}}),t,this)}))),function(t,e){return m.apply(this,arguments)})},{key:"takeMany",value:(v=y(p.mark((function t(e,r){var n,i,u,a;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n={}).requestType="takeBy",n.recordName=e.name,n.query={$filter:{"@doc.id":{$in:r}}},i=this.requestFor(n),t.next=7,this.makeRequest(i);case 7:if(u=t.sent,o(u.status<400,"Request failed with status ".concat(u.status," ").concat(u.message)),null==(a=u.body)||""===a){t.next=15;break}return d.isString(a)&&(a=JSON.parse(a)),t.abrupt("return",a[this.recordMultipleName(e.name)]);case 15:o.fail("Record payload has not existed in response body.");case 16:case"end":return t.stop()}}),t,this)}))),function(t,e){return v.apply(this,arguments)})},{key:"takeAll",value:(f=y(p.mark((function t(e){var r,n,i,u;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r={}).requestType="takeAll",r.recordName=e.name,r.query={},n=this.requestFor(r),t.next=7,this.makeRequest(n);case 7:if(i=t.sent,o(i.status<400,"Request failed with status ".concat(i.status," ").concat(i.message)),null==(u=i.body)||""===u){t.next=15;break}return d.isString(u)&&(u=JSON.parse(u)),t.abrupt("return",u[this.recordMultipleName(e.name)]);case 15:o.fail("Record payload has not existed in response body.");case 16:case"end":return t.stop()}}),t,this)}))),function(t){return f.apply(this,arguments)})},{key:"includes",value:(l=y(p.mark((function t(e,r,n){var o,i;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={$forIn:{"@doc":n},$filter:{"@doc.id":{$eq:r}},$limit:1,$return:"@doc"},t.t0=this,t.next=4,this.parseQuery(o);case 4:return t.t1=t.sent,t.next=7,t.t0.executeQuery.call(t.t0,t.t1);case 7:return i=t.sent,t.abrupt("return",null!=i&&null!=i[0]);case 9:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return l.apply(this,arguments)})},{key:"length",value:(c=y(p.mark((function t(e,r){var n,o;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={$forIn:{"@doc":r},$count:!0},t.t0=this,t.next=4,this.parseQuery(n);case 4:return t.t1=t.sent,t.next=7,t.t0.executeQuery.call(t.t0,t.t1);case 7:return o=t.sent,t.abrupt("return",null!=o&&null!=o[0]?o[0].count:0);case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"methodForRequest",value:function(t){switch(t.requestType){case"query":case"patchBy":case"removeBy":return"POST";case"takeBy":return"GET";default:return b(a(x.prototype),"methodForRequest",this).call(this,t)}}},{key:"dataForRequest",value:function(t){t.recordName,t.snapshot;var e=t.requestType,r=t.query;return"query"===e||"patchBy"===e||"removeBy"===e?{query:r}:b(a(x.prototype),"dataForRequest",this).call(this,t)}},{key:"makeURL",value:function(t,e,r,n){var o=b(a(x.prototype),"makeURL",this).apply(this,arguments);return n&&null!=this.queryEndpoint&&(o+=encodeURIComponent(this.queryEndpoint)),null!=e&&(e=encodeURIComponent(JSON.stringify(null!=e?e:"")),o+="?query=".concat(e)),o}},{key:"urlForQuery",value:function(t,e){return this.makeURL(t,null,null,!0)}},{key:"urlForPatchBy",value:function(t,e){return this.makeURL(t,null,null,!0)}},{key:"urlForRemoveBy",value:function(t,e){return this.makeURL(t,null,null,!0)}},{key:"urlForTakeBy",value:function(t,e){return this.makeURL(t,e,null,!1)}},{key:"buildURL",value:function(t,e,r,n,o){switch(n){case"query":return this.urlForQuery(t,o);case"patchBy":return this.urlForPatchBy(t,o);case"removeBy":return this.urlForRemoveBy(t,o);case"takeBy":return this.urlForTakeBy(t,o);case"takeAll":case"take":case"push":case"remove":case"override":default:return b(a(x.prototype),"buildURL",this).apply(this,arguments)}}},{key:"parseQuery",value:(u=y(p.mark((function t(e,r){var n;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n={},t.t0=!1,t.next=t.t0===(null==r.$remove)?4:t.t0===(null==r.$patch)?11:18;break;case 4:if(null==r.$forIn){t.next=10;break}return n.requestType="removeBy",n.recordName=e.name,n.query=r,n.isCustomReturn=!0,t.abrupt("return",n);case 10:return t.abrupt("break",23);case 11:if(null==r.$forIn){t.next=17;break}return n.requestType="patchBy",n.recordName=e.name,n.query=r,n.isCustomReturn=!0,t.abrupt("return",n);case 17:return t.abrupt("break",23);case 18:return n.requestType="query",n.recordName=e.name,n.query=r,n.isCustomReturn=null!=r.$collect||null!=r.$count||null!=r.$sum||null!=r.$min||null!=r.$max||null!=r.$avg||null!=r.$remove||"@doc"!==r.$return,t.abrupt("return",n);case 23:case"end":return t.stop()}}),t)}))),function(t,e){return u.apply(this,arguments)})},{key:"executeQuery",value:(r=y(p.mark((function t(e,r){var n,i,u;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.requestFor(r),t.next=3,this.makeRequest(n);case 3:if(i=t.sent,o(i.status<400,"Request failed with status ".concat(i.status," ").concat(i.message)),null==(u=i.body)||""===u){t.next=12;break}return d.isString(u)&&(u=JSON.parse(u)),d.isArray(u)||(u=[u]),t.abrupt("return",u);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})}]),x}(e),x.object={},c(m=k,"object",[l],(w=(w=Object.getOwnPropertyDescriptor(m,"object"))?w.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return w}}),m),g=c(m.prototype,"queryEndpoint",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"query"}}),c(m.prototype,"takeBy",[v],Object.getOwnPropertyDescriptor(m.prototype,"takeBy"),m.prototype),c(m.prototype,"takeMany",[v],Object.getOwnPropertyDescriptor(m.prototype,"takeMany"),m.prototype),c(m.prototype,"takeAll",[v],Object.getOwnPropertyDescriptor(m.prototype,"takeAll"),m.prototype),c(m.prototype,"includes",[v],Object.getOwnPropertyDescriptor(m.prototype,"includes"),m.prototype),c(m.prototype,"length",[v],Object.getOwnPropertyDescriptor(m.prototype,"length"),m.prototype),c(m.prototype,"methodForRequest",[v],Object.getOwnPropertyDescriptor(m.prototype,"methodForRequest"),m.prototype),c(m.prototype,"dataForRequest",[v],Object.getOwnPropertyDescriptor(m.prototype,"dataForRequest"),m.prototype),c(m.prototype,"makeURL",[v],Object.getOwnPropertyDescriptor(m.prototype,"makeURL"),m.prototype),c(m.prototype,"urlForQuery",[v],Object.getOwnPropertyDescriptor(m.prototype,"urlForQuery"),m.prototype),c(m.prototype,"urlForPatchBy",[v],Object.getOwnPropertyDescriptor(m.prototype,"urlForPatchBy"),m.prototype),c(m.prototype,"urlForRemoveBy",[v],Object.getOwnPropertyDescriptor(m.prototype,"urlForRemoveBy"),m.prototype),c(m.prototype,"urlForTakeBy",[v],Object.getOwnPropertyDescriptor(m.prototype,"urlForTakeBy"),m.prototype),c(m.prototype,"buildURL",[v],Object.getOwnPropertyDescriptor(m.prototype,"buildURL"),m.prototype),c(m.prototype,"parseQuery",[v],Object.getOwnPropertyDescriptor(m.prototype,"parseQuery"),m.prototype),c(m.prototype,"executeQuery",[v],Object.getOwnPropertyDescriptor(m.prototype,"executeQuery"),m.prototype),r=m))||r}))}(r=function(e){var r=e.NS,o=(r.Cursor,r.Query),i=(r.assert,r.initializeMixin),u=r.meta,a=r.method,s=r.Utils._;e.defineMixin("/mixins/QueryableCollectionMixin.js",(function(e){var r,l,f,v,b;return i((b=v=function(e){n(k,e);var r,i,u,a,c,l,f,v,b,m,d,w,O,x=g(k);function k(){return t(this,k),x.apply(this,arguments)}return h(k,[{key:"findBy",value:(O=y(p.mark((function t(e){var r,n=arguments;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},t.next=3,this.takeBy(e,r);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return O.apply(this,arguments)})},{key:"takeBy",value:(w=y(p.mark((function t(e){var r,n,o=arguments;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},t.next=3,this.adapter.takeBy(this.delegate,e,r);case 3:return n=t.sent,t.abrupt("return",this._cursorFactory(this.getName(),n));case 5:case"end":return t.stop()}}),t,this)}))),function(t){return w.apply(this,arguments)})},{key:"deleteBy",value:(d=y(p.mark((function t(e){var r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.takeBy(e);case 2:return r=t.sent,t.next=5,r.forEach(function(){var t=y(p.mark((function t(e){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delete();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}}),t,this)}))),function(t){return d.apply(this,arguments)})},{key:"destroyBy",value:(m=y(p.mark((function t(e){var r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.takeBy(e);case 2:return r=t.sent,t.next=5,r.forEach(function(){var t=y(p.mark((function t(e){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.destroy();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)})},{key:"removeBy",value:(b=y(p.mark((function t(e){var r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.new().forIn({"@doc":this.collectionFullName()}).filter(e).remove("@doc").into(this.collectionFullName()),t.next=3,this.query(r);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return b.apply(this,arguments)})},{key:"updateBy",value:(v=y(p.mark((function t(e,r){var n;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.takeBy(e);case 2:return n=t.sent,t.next=5,n.forEach(function(){var t=y(p.mark((function t(e){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateAttributes(r);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return v.apply(this,arguments)})},{key:"patchBy",value:(f=y(p.mark((function t(e,r){var n;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.new().forIn({"@doc":this.collectionFullName()}).filter(e).patch(r).into(this.collectionFullName()),t.next=3,this.query(n);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return f.apply(this,arguments)})},{key:"includes",value:(l=y(p.mark((function t(e){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.adapter.includes(this.delegate,e,this.collectionFullName());case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"length",value:(c=y(p.mark((function t(){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.adapter.length(this.delegate,this.collectionFullName());case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"exists",value:(a=y(p.mark((function t(e){var r,n;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.new().forIn({"@doc":this.collectionFullName()}).filter(e).limit(1).return("@doc"),t.next=3,this.query(r);case 3:return n=t.sent,t.next=6,n.hasNext();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"query",value:(u=y(p.mark((function t(e){var r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.isPlainObject(e)?(e=s.pick(e,Object.keys(e).filter((function(t){return null!=e[t]}))),o.new(e)):e,t.t0=this,t.next=4,this.parseQuery(r);case 4:return t.t1=t.sent,t.next=7,t.t0.executeQuery.call(t.t0,t.t1);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"parseQuery",value:(i=y(p.mark((function t(e){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.adapter.parseQuery(this.delegate,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"executeQuery",value:(r=y(p.mark((function t(e){var r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.adapter.executeQuery(this.delegate,e);case 2:if(r=t.sent,!e.isCustomReturn){t.next=7;break}return t.abrupt("return",this._cursorFactory(null,r));case 7:return t.abrupt("return",this._cursorFactory(this.getName(),r));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})}]),k}(e),v.object={},c(l=b,"object",[u],(f=(f=Object.getOwnPropertyDescriptor(l,"object"))?f.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return f}}),l),c(l.prototype,"findBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"findBy"),l.prototype),c(l.prototype,"takeBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"takeBy"),l.prototype),c(l.prototype,"deleteBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"deleteBy"),l.prototype),c(l.prototype,"destroyBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"destroyBy"),l.prototype),c(l.prototype,"removeBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"removeBy"),l.prototype),c(l.prototype,"updateBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"updateBy"),l.prototype),c(l.prototype,"patchBy",[a],Object.getOwnPropertyDescriptor(l.prototype,"patchBy"),l.prototype),c(l.prototype,"includes",[a],Object.getOwnPropertyDescriptor(l.prototype,"includes"),l.prototype),c(l.prototype,"length",[a],Object.getOwnPropertyDescriptor(l.prototype,"length"),l.prototype),c(l.prototype,"exists",[a],Object.getOwnPropertyDescriptor(l.prototype,"exists"),l.prototype),c(l.prototype,"query",[a],Object.getOwnPropertyDescriptor(l.prototype,"query"),l.prototype),c(l.prototype,"parseQuery",[a],Object.getOwnPropertyDescriptor(l.prototype,"parseQuery"),l.prototype),c(l.prototype,"executeQuery",[a],Object.getOwnPropertyDescriptor(l.prototype,"executeQuery"),l.prototype),r=l))||r}))}(r=function(e){var r=e.NS,o=r.Query,i=r.initializeMixin,u=r.meta,a=r.method;e.defineMixin("/mixins/GenerateAutoincrementIdMixin.js",(function(e){var r,s,l,f,v;return i((v=f=function(e){n(u,e);var r,i=w(u);function u(){return t(this,u),i.apply(this,arguments)}return h(u,[{key:"generateId",value:(r=y(p.mark((function t(){var e,r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=o.new().forIn({"@doc":this.collectionFullName()}).max("@doc.id"),t.next=3,this.query(e);case 3:return t.next=5,t.sent.first();case 5:return r=(r=t.sent)||0,t.abrupt("return",++r);case 8:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})}]),u}(e),f.object={},c(s=v,"object",[u],(l=(l=Object.getOwnPropertyDescriptor(s,"object"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),s),c(s.prototype,"generateId",[a],Object.getOwnPropertyDescriptor(s.prototype,"generateId"),s.prototype),r=s))||r}))}(r=function(e){var r,o,u,l,f,v,w,g,O,x,k,$,j,P,D,R,q,N,B,F,Q,z,L,S,E,_=e.NS,I=_.CoreObject,M=(_.assert,_.initialize),T=_.partOf,A=_.meta,U=_.property,J=_.method,C=_.nameBy;_.Utils._,M(r=T(e)((E=S=function(e){n(c,e);var r,o,u=m(c);function c(e){var r;if(t(this,c),r=u.apply(this,arguments),s(r,"$forIn",f,i(r)),s(r,"$join",v,i(r)),s(r,"$let",w,i(r)),s(r,"$filter",g,i(r)),s(r,"$collect",O,i(r)),s(r,"$into",x,i(r)),s(r,"$having",k,i(r)),s(r,"$sort",$,i(r)),s(r,"$limit",j,i(r)),s(r,"$offset",P,i(r)),s(r,"$avg",D,i(r)),s(r,"$sum",R,i(r)),s(r,"$min",q,i(r)),s(r,"$max",N,i(r)),s(r,"$count",B,i(r)),s(r,"$distinct",F,i(r)),s(r,"$remove",Q,i(r)),s(r,"$patch",z,i(r)),s(r,"$return",L,i(r)),r.$forIn={},null!=e)for(var n in e)if(d.call(e,n)){var o=e[n];r[n]=o}return r}return h(c,[{key:"forIn",value:function(t){for(var e in t)if(d.call(t,e)){var r=t[e];this.$forIn[e]=r}return this}},{key:"join",value:function(t){return this.$join=t,this}},{key:"filter",value:function(t){return this.$filter=t,this}},{key:"let",value:function(t){for(var e in null==this.$let&&(this.$let={}),t)if(d.call(t,e)){var r=t[e];this.$let[e]=r}return this}},{key:"collect",value:function(t){return this.$collect=t,this}},{key:"into",value:function(t){return this.$into=t,this}},{key:"having",value:function(t){return this.$having=t,this}},{key:"sort",value:function(t){return null==this.$sort&&(this.$sort=[]),this.$sort.push(t),this}},{key:"limit",value:function(t){return this.$limit=t,this}},{key:"offset",value:function(t){return this.$offset=t,this}},{key:"distinct",value:function(){return this.$distinct=!0,this}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return this.$remove=t,this}},{key:"patch",value:function(t){return this.$patch=t,this}},{key:"return",value:function(t){return this.$return=t,this}},{key:"count",value:function(){return this.$count=!0,this}},{key:"avg",value:function(t){return this.$avg=t,this}},{key:"min",value:function(t){return this.$min=t,this}},{key:"max",value:function(t){return this.$max=t,this}},{key:"sum",value:function(t){return this.$sum=t,this}},{key:"toJSON",value:function(){for(var t={},e=0,r=["$forIn","$join","$let","$filter","$collect","$into","$having","$sort","$limit","$offset","$avg","$sum","$min","$max","$count","$distinct","$remove","$patch","$return"];e<r.length;e++){var n=r[e];null!=this[n]&&(t[n]=this[n])}return t}}],[{key:"restoreObject",value:(o=y(p.mark((function t(e,r){return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((null!=r?r.class:void 0)!==this.name||"instance"!==(null!=r?r.type:void 0)){t.next=4;break}return t.abrupt("return",this.new(r.query));case 4:return t.next=6,b(a(c),"restoreObject",this).call(this,e,r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"replicateObject",value:(r=y(p.mark((function t(e){var r;return p.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(a(c),"replicateObject",this).call(this,e);case 2:return(r=t.sent).query=e.toJSON(),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})}]),c}(I),S.__filename="/query/Query.js",S.object={},c(o=E,"__filename",[C],(u=(u=Object.getOwnPropertyDescriptor(o,"__filename"))?u.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return u}}),o),c(o,"object",[A],(l=(l=Object.getOwnPropertyDescriptor(o,"object"))?l.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return l}}),o),f=c(o.prototype,"$forIn",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=c(o.prototype,"$join",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=c(o.prototype,"$let",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=c(o.prototype,"$filter",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=c(o.prototype,"$collect",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=c(o.prototype,"$into",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=c(o.prototype,"$having",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=c(o.prototype,"$sort",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=c(o.prototype,"$limit",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=c(o.prototype,"$offset",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=c(o.prototype,"$avg",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=c(o.prototype,"$sum",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=c(o.prototype,"$min",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=c(o.prototype,"$max",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=c(o.prototype,"$count",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=c(o.prototype,"$distinct",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=c(o.prototype,"$remove",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=c(o.prototype,"$patch",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=c(o.prototype,"$return",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c(o.prototype,"forIn",[J],Object.getOwnPropertyDescriptor(o.prototype,"forIn"),o.prototype),c(o.prototype,"join",[J],Object.getOwnPropertyDescriptor(o.prototype,"join"),o.prototype),c(o.prototype,"filter",[J],Object.getOwnPropertyDescriptor(o.prototype,"filter"),o.prototype),c(o.prototype,"let",[J],Object.getOwnPropertyDescriptor(o.prototype,"let"),o.prototype),c(o.prototype,"collect",[J],Object.getOwnPropertyDescriptor(o.prototype,"collect"),o.prototype),c(o.prototype,"into",[J],Object.getOwnPropertyDescriptor(o.prototype,"into"),o.prototype),c(o.prototype,"having",[J],Object.getOwnPropertyDescriptor(o.prototype,"having"),o.prototype),c(o.prototype,"sort",[J],Object.getOwnPropertyDescriptor(o.prototype,"sort"),o.prototype),c(o.prototype,"limit",[J],Object.getOwnPropertyDescriptor(o.prototype,"limit"),o.prototype),c(o.prototype,"offset",[J],Object.getOwnPropertyDescriptor(o.prototype,"offset"),o.prototype),c(o.prototype,"distinct",[J],Object.getOwnPropertyDescriptor(o.prototype,"distinct"),o.prototype),c(o.prototype,"remove",[J],Object.getOwnPropertyDescriptor(o.prototype,"remove"),o.prototype),c(o.prototype,"patch",[J],Object.getOwnPropertyDescriptor(o.prototype,"patch"),o.prototype),c(o.prototype,"return",[J],Object.getOwnPropertyDescriptor(o.prototype,"return"),o.prototype),c(o.prototype,"count",[J],Object.getOwnPropertyDescriptor(o.prototype,"count"),o.prototype),c(o.prototype,"avg",[J],Object.getOwnPropertyDescriptor(o.prototype,"avg"),o.prototype),c(o.prototype,"min",[J],Object.getOwnPropertyDescriptor(o.prototype,"min"),o.prototype),c(o.prototype,"max",[J],Object.getOwnPropertyDescriptor(o.prototype,"max"),o.prototype),c(o.prototype,"sum",[J],Object.getOwnPropertyDescriptor(o.prototype,"sum"),o.prototype),c(o,"restoreObject",[J],Object.getOwnPropertyDescriptor(o,"restoreObject"),o),c(o,"replicateObject",[J],Object.getOwnPropertyDescriptor(o,"replicateObject"),o),c(o.prototype,"toJSON",[J],Object.getOwnPropertyDescriptor(o.prototype,"toJSON"),o.prototype),r=o))||r)}(r=o(($=v=function(e){n(o,e);var r=k(o);function o(){return t(this,o),r.apply(this,arguments)}return o}(e),v.object={},c(l=$,"object",[u],(f=(f=Object.getOwnPropertyDescriptor(l,"object"))?f.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return f}}),l),r=l))||r)||r)||r)||r)||r)||r}]};
